import{c as ie,b as ce,_ as de,a as ue}from"./gFKvgYVH.js";import{_ as ve}from"./DPT98cEI.js";import{_ as he}from"./MSWrGCcy.js";import{_ as me}from"./BePr-7gU.js";import{_ as _e}from"./DWXLwVMu.js";import{e as xe,r as y,g as fe,c as u,a as t,h as g,i as B,b as i,w as c,t as l,F as O,j as L,m as q,k as $,L as pe,o as d,d as b,l as K,J as ye,n as ge}from"#entry";import{u as be}from"./BmWNdDnL.js";import{u as ke}from"./DHKOOHM0.js";import"./BEHD0UYf.js";import"./D3nKW_CT.js";const we={class:"space-y-8"},Ce={key:0,class:"flex justify-center"},$e={class:"grid grid-cols-1 sm:grid-cols-3 gap-4 text-center"},Be={class:"text-lg font-semibold text-gray-900 dark:text-white"},je={class:"text-sm text-gray-600 dark:text-gray-400"},Te={class:"text-2xl font-bold text-red-600 dark:text-red-400"},Me={class:"text-2xl font-bold text-blue-600 dark:text-blue-400"},Se={key:1,class:"bg-blue-50 dark:bg-blue-900/20 border border-blue-200 dark:border-blue-800 rounded-lg p-4"},Ae={class:"flex items-center justify-between"},De={class:"text-blue-700 dark:text-blue-300"},Pe={key:2,class:"space-y-6"},Ve={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 md:gap-6"},ze={class:"grid grid-cols-2 gap-2 text-sm"},Ee={class:"flex justify-between"},Oe={class:"font-medium"},Le={class:"flex justify-between"},Ie={class:"font-medium"},Fe={class:"flex justify-between"},Ne={class:"font-medium"},Re={class:"flex justify-between"},Xe={class:"font-medium"},He={class:"border-t pt-3"},Ge={class:"flex justify-between text-sm"},Ue={class:"font-medium text-blue-600 dark:text-blue-400"},Je={class:"flex justify-between text-sm"},Ze={class:"font-medium text-yellow-600 dark:text-yellow-400"},qe={key:3,class:"space-y-6"},Ke={class:"text-center"},Qe={class:"text-gray-600 dark:text-gray-400"},We={class:"grid grid-cols-1 md:grid-cols-2 gap-4 md:gap-8"},Ye={class:"text-center"},et={class:"text-xl font-bold text-blue-600 dark:text-blue-400 mb-4"},tt={class:"space-y-2"},at={class:"text-sm text-gray-600 dark:text-gray-400"},st={class:"text-xs text-gray-500 dark:text-gray-400 text-center"},lt={class:"text-center"},rt={class:"text-xl font-bold text-red-600 dark:text-red-400 mb-4"},ot={class:"space-y-2"},nt={class:"text-sm text-gray-600 dark:text-gray-400"},it={class:"text-xs text-gray-500 dark:text-gray-400 text-center"},ct={class:"mt-8 text-center"},dt={class:"space-y-4"},ut={class:"text-lg font-medium text-gray-900 dark:text-white"},vt={key:0,class:"space-y-4"},ht={class:"flex flex-col sm:flex-row gap-2 sm:gap-4 justify-center"},mt={key:0,class:"space-y-2"},_t={class:"grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-2 justify-center"},xt={class:"truncate"},ft={key:0,class:"ml-1 text-xs"},pt={key:1,class:"text-center"},yt={class:"text-gray-600 dark:text-gray-400"},gt={key:0,class:"mt-4 md:mt-8"},bt={class:"bg-gray-50 dark:bg-gray-800 rounded-lg p-3 md:p-4 max-h-32 md:max-h-48 overflow-y-auto"},kt={class:"space-y-1 md:space-y-2"},wt={key:4,class:"space-y-6"},Ct={class:"text-center"},$t={key:0,class:"space-y-3"},Bt={class:"grid grid-cols-2 gap-4"},jt={class:"flex justify-between"},Tt={class:"font-medium text-blue-600 dark:text-blue-400"},Mt={class:"flex justify-between"},St={class:"font-medium text-yellow-600 dark:text-yellow-400"},At={key:0,class:"col-span-2"},Dt={class:"font-medium text-green-600 dark:text-green-400 ml-2"},Pt={key:1,class:"text-center p-4 bg-blue-50 dark:bg-blue-900/20 rounded-lg"},Vt={class:"text-lg font-bold text-blue-600 dark:text-blue-400"},zt={class:"flex gap-4 justify-center pt-4"},Et={key:5,class:"text-center py-8"},Zt=xe({__name:"batalhas",setup(Ot){const n=be(),M=y(!1),x=y(!1),f=y("selecting"),I=y([]),a=y(null),p=y(null),k=y("player"),m=y("Escolha sua aÃ§Ã£o!"),S=y([]),_=y({}),w=y([]),Q=s=>{switch(s){case"easy":return"border-green-200 hover:border-green-300";case"medium":return"border-yellow-200 hover:border-yellow-300";case"hard":return"border-red-200 hover:border-red-300";default:return""}},W=s=>{switch(s){case"easy":return"default";case"medium":return"secondary";case"hard":return"destructive";default:return"default"}},Y=s=>{switch(s){case"easy":return"FÃ¡cil";case"medium":return"MÃ©dio";case"hard":return"DifÃ­cil";default:return"Desconhecido"}},C=s=>{const e=new Date().toLocaleTimeString();w.value.unshift(`[${e}] ${s}`),w.value.length>20&&(w.value=w.value.slice(0,20))},F=async()=>{if(n.currentCharacter){M.value=!0;try{const s=$("@mmo/ninja/token"),e=await $fetch(`/api/battles/opponents?level=${n.currentCharacter.level}`,{headers:{Authorization:`Bearer ${s.value}`}});I.value=e.data||[]}catch(s){console.error("Erro ao carregar oponentes:",s)}finally{M.value=!1}}},N=async()=>{if(n.currentCharacter)try{const s=$("@mmo/ninja/token"),e=await $fetch(`/api/skills/${n.currentCharacter.id}`,{headers:{Authorization:`Bearer ${s.value}`}});S.value=e.data||[];const r=new Date;S.value.forEach(v=>{if(v.last_used){const h=new Date(v.last_used+"Z"),D=v.cooldown_seconds||1,T=(r.getTime()-h.getTime())/1e3;if(T>=0&&T<D){const E=Math.ceil(D-T);_.value[v.skill_name]=E}else _.value[v.skill_name]=0}else _.value[v.skill_name]=0})}catch{}},A=async()=>{if(!(!a.value||!n.currentCharacter))try{const s=$("@mmo/ninja/token");await $fetch("/api/battles/save",{method:"POST",headers:{Authorization:`Bearer ${s.value}`},body:{character_id:n.currentCharacter.id,battle_type:"normal",opponent_data:a.value.opponent,character_health:a.value.character.stats.health,opponent_health:a.value.opponent.stats.health,battle_turn:1,battle_data:{skillCooldowns:_.value,battleMessage:m.value}}})}catch{}},R=async()=>{if(n.currentCharacter)try{const s=$("@mmo/ninja/token"),e=await $fetch(`/api/battles/active?character_id=${n.currentCharacter.id}`,{headers:{Authorization:`Bearer ${s.value}`}});if(e.success&&e.data){const r=e.data;a.value={character:{...n.currentCharacter,stats:{...n.currentCharacter.stats,health:r.character_health}},opponent:{...r.opponent_data,stats:{...r.opponent_data.stats,health:r.opponent_health}},battle_id:`restored_${r.id}`},r.battle_data&&(_.value=r.battle_data.skillCooldowns||{},m.value=r.battle_data.battleMessage||""),f.value="battling",U()}}catch{}},X=async()=>{if(n.currentCharacter)try{const s=$("@mmo/ninja/token");await $fetch("/api/battles/finish",{method:"POST",headers:{Authorization:`Bearer ${s.value}`},body:{character_id:n.currentCharacter.id}})}catch{}},H=async s=>{if(n.currentCharacter){x.value=!0;try{const e=$("@mmo/ninja/token"),r=await $fetch("/api/battles/start",{method:"POST",headers:{Authorization:`Bearer ${e.value}`},body:{character_id:n.currentCharacter.id,opponent_id:s.id}});r.success&&(a.value=r.data,f.value="battling",k.value="player",m.value="Escolha sua aÃ§Ã£o!",w.value=[],C(`Batalha iniciada contra ${s.name}!`),U(),await A())}catch{}finally{x.value=!1}}},ee=async()=>{if(!a.value)return;x.value=!0,m.value="VocÃª ataca!";const s=Math.max(1,a.value.character.stats.strength-a.value.opponent.stats.defense+Math.floor(Math.random()*5));a.value.opponent.stats.health=Math.max(0,a.value.opponent.stats.health-s),C(`${a.value.character.name} ataca e causa ${s} de dano!`),await new Promise(e=>setTimeout(e,1e3)),a.value.opponent.stats.health<=0?await z("victory"):(await A(),k.value="enemy",m.value=`${a.value.opponent.name} ataca de volta!`,await new Promise(e=>setTimeout(e,1e3)),await V()),x.value=!1},te=async s=>{if(a.value){x.value=!0,m.value=`VocÃª usa ${s.skill_name}!`;try{const e=$("@mmo/ninja/token"),r=await $fetch("/api/skills/use",{method:"POST",headers:{Authorization:`Bearer ${e.value}`},body:{character_id:a.value.character.id,skill_name:s.skill_name}});if(r.success){const v=r.data.damage;a.value.opponent.stats.health=Math.max(0,a.value.opponent.stats.health-v),_.value[s.skill_name]=r.data.cooldown_seconds,m.value=`${s.skill_name} causou ${v} de dano!`,C(`${a.value.character.name} usa ${s.skill_name} e causa ${v} de dano!`),await new Promise(h=>setTimeout(h,1e3)),a.value.opponent.stats.health<=0?await z("victory"):(await A(),k.value="enemy",m.value=`${a.value.opponent.name} ataca de volta!`,await new Promise(h=>setTimeout(h,1e3)),await V())}}catch(e){m.value=e.data?.message||"Erro ao usar habilidade"}finally{x.value=!1}}},G=s=>_.value[s]>0,ae=s=>{const e=_.value[s];return e>0?`${e}s`:""},se=async()=>{a.value&&(x.value=!0,m.value="VocÃª se defende!",C(`${a.value.character.name} se defende!`),await new Promise(s=>setTimeout(s,1e3)),k.value="enemy",m.value=`${a.value.opponent.name} ataca!`,await new Promise(s=>setTimeout(s,1e3)),await V(.5),x.value=!1)},V=async(s=1)=>{if(!a.value)return;const e=Math.max(1,Math.floor((a.value.opponent.stats.strength-a.value.character.stats.defense+Math.floor(Math.random()*5))*s));a.value.character.stats.health=Math.max(0,a.value.character.stats.health-e),C(`${a.value.opponent.name} ataca e causa ${e} de dano!`),a.value.character.stats.health<=0?await z("defeat"):(await A(),k.value="player",m.value="Escolha sua aÃ§Ã£o!")},z=async s=>{if(a.value)try{const e=$("@mmo/ninja/token"),r=a.value.battle_type==="story",v=a.value.chapter,h=await $fetch("/api/battles/resolve",{method:"POST",headers:{Authorization:`Bearer ${e.value}`},body:{character_id:a.value.character.id,opponent_id:a.value.opponent.id,outcome:s,character_health_remaining:a.value.character.stats.health,battle_type:r?"story":"normal",chapter:v}});h.success&&(p.value=h.data,f.value="result",s==="victory"?(C(`ðŸŽ‰ ${a.value.character.name} venceu a batalha!`),r&&h.data.chapter_completed&&C(`ðŸ“– CapÃ­tulo ${v} completado!`)):C(`ðŸ’€ ${a.value.character.name} foi derrotado!`),await X(),await n.loadCharacters())}catch{}},le=()=>{f.value="selecting",a.value=null,p.value=null,k.value="player",m.value="Escolha sua aÃ§Ã£o!",_.value={},w.value=[],re()};let j=null;const U=()=>{j&&clearInterval(j),j=pe(()=>{Object.keys(_.value).forEach(s=>{_.value[s]>0&&(_.value[s]--,_.value[s]<=0&&delete _.value[s])})},1e3)},re=()=>{j&&(clearInterval(j),j=null)},{ensureCharacterSelected:oe,onCharacterChange:ne}=ke();return fe(async()=>{await oe(),await R(),await N(),f.value==="selecting"&&await F(),ne(async s=>{await R(),await N(),f.value==="selecting"&&await F()})}),(s,e)=>{const r=ce,v=ie,h=ve,D=he,T=ue,E=me,J=de,Z=_e;return d(),u("div",we,[e[26]||(e[26]=t("div",{class:"text-center"},[t("h1",{class:"text-2xl md:text-4xl font-bold text-gray-900 dark:text-white mb-2"}," Batalhas "),t("p",{class:"text-gray-600 dark:text-gray-400 text-sm md:text-base"}," Enfrente oponentes e ganhe XP, recursos e glÃ³ria! ")],-1)),B(n).currentCharacter?(d(),u("div",Ce,[i(v,{class:"w-full max-w-2xl"},{default:c(()=>[i(r,{class:"p-4 md:p-6"},{default:c(()=>[t("div",$e,[t("div",null,[t("h3",Be,l(B(n).currentCharacter.name),1),t("p",je," NÃ­vel "+l(B(n).currentCharacter.level),1)]),t("div",null,[t("div",Te,l(B(n).currentCharacter.stats.health)+"/"+l(B(n).currentCharacter.stats.max_health),1),e[2]||(e[2]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"Vida",-1))]),t("div",null,[t("div",Me,l(B(n).currentCharacter.xp),1),e[3]||(e[3]=t("p",{class:"text-sm text-gray-600 dark:text-gray-400"},"XP",-1))])])]),_:1})]),_:1})])):g("",!0),f.value==="battling"&&a.value?(d(),u("div",Se,[t("div",Ae,[t("div",null,[e[4]||(e[4]=t("h3",{class:"text-lg font-semibold text-blue-900 dark:text-blue-100"}," Batalha em Andamento ",-1)),t("p",De," VocÃª estÃ¡ em batalha contra "+l(a.value.opponent.name),1)]),i(h,{onClick:e[0]||(e[0]=o=>{f.value="selecting",a.value=null,X()}),variant:"outline",size:"sm"},{default:c(()=>[...e[5]||(e[5]=[b(" Abandonar Batalha ",-1)])]),_:1})])])):g("",!0),f.value==="selecting"?(d(),u("div",Pe,[t("div",Ve,[(d(!0),u(O,null,L(I.value,o=>(d(),K(v,{key:o.id,class:q(["hover:shadow-lg transition-all duration-200 cursor-pointer",Q(o.difficulty)]),onClick:P=>H(o)},{default:c(()=>[i(J,null,{default:c(()=>[i(T,{class:"flex items-center justify-between"},{default:c(()=>[t("span",null,l(o.name),1),i(D,{variant:W(o.difficulty)},{default:c(()=>[b(l(Y(o.difficulty)),1)]),_:2},1032,["variant"])]),_:2},1024),i(E,null,{default:c(()=>[b(" NÃ­vel "+l(o.level),1)]),_:2},1024)]),_:2},1024),i(r,{class:"space-y-4"},{default:c(()=>[t("div",ze,[t("div",Ee,[e[6]||(e[6]=t("span",{class:"text-gray-600 dark:text-gray-400"},"ForÃ§a:",-1)),t("span",Oe,l(o.stats.strength),1)]),t("div",Le,[e[7]||(e[7]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Agilidade:",-1)),t("span",Ie,l(o.stats.agility),1)]),t("div",Fe,[e[8]||(e[8]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Defesa:",-1)),t("span",Ne,l(o.stats.defense),1)]),t("div",Re,[e[9]||(e[9]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Vida:",-1)),t("span",Xe,l(o.stats.health),1)])]),t("div",He,[e[12]||(e[12]=t("h4",{class:"text-sm font-medium text-gray-900 dark:text-white mb-2"}," Recompensas: ",-1)),t("div",Ge,[e[10]||(e[10]=t("span",{class:"text-gray-600 dark:text-gray-400"},"XP:",-1)),t("span",Ue,l(o.xp_reward),1)]),t("div",Je,[e[11]||(e[11]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Ouro:",-1)),t("span",Ze,l(o.gold_reward),1)])]),i(h,{class:"w-full",disabled:M.value,onClick:ye(P=>H(o),["stop"])},{default:c(()=>[b(l(M.value?"Iniciando...":"Batalhar"),1)]),_:1},8,["disabled","onClick"])]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))])])):f.value==="battling"?(d(),u("div",qe,[t("div",Ke,[e[13]||(e[13]=t("h2",{class:"text-2xl font-bold text-gray-900 dark:text-white mb-2"}," Batalha em Andamento ",-1)),t("p",Qe,l(a.value?.character.name)+" vs "+l(a.value?.opponent.name),1)]),i(v,{class:"max-w-4xl mx-auto"},{default:c(()=>[i(r,{class:"p-4 md:p-8"},{default:c(()=>[t("div",We,[t("div",Ye,[t("h3",et,l(a.value?.character.name),1),t("div",tt,[t("div",at," Vida: "+l(a.value?.character.stats.health)+"/"+l(a.value?.character.stats.max_health),1),i(Z,{"model-value":Math.min(100,(a.value?.character.stats.health||0)/(a.value?.character.stats.max_health||1)*100),class:"h-3"},null,8,["model-value"]),t("div",st,l(Math.round((a.value?.character.stats.health||0)/(a.value?.character.stats.max_health||1)*100))+"% ",1)])]),t("div",lt,[t("h3",rt,l(a.value?.opponent.name),1),t("div",ot,[t("div",nt," Vida: "+l(a.value?.opponent.stats.health)+"/"+l(a.value?.opponent.stats.max_health),1),i(Z,{"model-value":Math.min(100,(a.value?.opponent.stats.health||0)/(a.value?.opponent.stats.max_health||1)*100),class:"h-3"},null,8,["model-value"]),t("div",it,l(Math.round((a.value?.opponent.stats.health||0)/(a.value?.opponent.stats.max_health||1)*100))+"% ",1)])])]),t("div",ct,[t("div",dt,[t("div",ut,l(m.value),1),k.value==="player"?(d(),u("div",vt,[t("div",ht,[i(h,{onClick:ee,disabled:x.value,class:"w-full sm:w-auto"},{default:c(()=>[b(l(x.value?"Atacando...":"Atacar"),1)]),_:1},8,["disabled"]),i(h,{onClick:se,variant:"outline",disabled:x.value,class:"w-full sm:w-auto"},{default:c(()=>[...e[14]||(e[14]=[b(" Defender ",-1)])]),_:1},8,["disabled"])]),S.value.length>0?(d(),u("div",mt,[e[15]||(e[15]=t("h4",{class:"text-sm font-medium text-gray-900 dark:text-white text-center"}," Habilidades: ",-1)),t("div",_t,[(d(!0),u(O,null,L(S.value,o=>(d(),K(h,{key:o.id,onClick:P=>te(o),variant:"secondary",size:"sm",class:"w-full",disabled:x.value||G(o.skill_name)},{default:c(()=>[t("span",xt,l(o.skill_name),1),G(o.skill_name)?(d(),u("span",ft," ("+l(ae(o.skill_name))+") ",1)):g("",!0)]),_:2},1032,["onClick","disabled"]))),128))])])):g("",!0)])):k.value==="enemy"?(d(),u("div",pt,[t("div",yt,l(a.value?.opponent.name)+" estÃ¡ pensando... ",1)])):g("",!0)]),w.value.length>0?(d(),u("div",gt,[e[16]||(e[16]=t("h4",{class:"text-base md:text-lg font-semibold text-gray-900 dark:text-white mb-2 md:mb-4 text-center"}," Log da Batalha ",-1)),t("div",bt,[t("div",kt,[(d(!0),u(O,null,L(w.value,(o,P)=>(d(),u("div",{key:P,class:"text-xs md:text-sm text-gray-700 dark:text-gray-300"},l(o),1))),128))])])])):g("",!0)])]),_:1})]),_:1})])):f.value==="result"?(d(),u("div",wt,[t("div",Ct,[t("h2",{class:q(["text-3xl font-bold mb-4",p.value?.outcome==="victory"?"text-green-600 dark:text-green-400":"text-red-600 dark:text-red-400"])},l(p.value?.outcome==="victory"?"ðŸŽ‰ VitÃ³ria!":"ðŸ’€ Derrota..."),3)]),i(v,{class:"max-w-2xl mx-auto"},{default:c(()=>[i(J,null,{default:c(()=>[i(T,{class:"text-center"},{default:c(()=>[...e[17]||(e[17]=[b("Resultado da Batalha",-1)])]),_:1})]),_:1}),i(r,{class:"space-y-4"},{default:c(()=>[p.value?.rewards?(d(),u("div",$t,[e[21]||(e[21]=t("h3",{class:"text-lg font-semibold text-gray-900 dark:text-white"}," Recompensas: ",-1)),t("div",Bt,[t("div",jt,[e[18]||(e[18]=t("span",{class:"text-gray-600 dark:text-gray-400"},"XP Ganho:",-1)),t("span",Tt," +"+l(p.value.rewards.xp),1)]),t("div",Mt,[e[19]||(e[19]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Ouro Ganho:",-1)),t("span",St," +"+l(p.value.rewards.gold),1)]),p.value.rewards.items?(d(),u("div",At,[e[20]||(e[20]=t("span",{class:"text-gray-600 dark:text-gray-400"},"Itens:",-1)),t("span",Dt,l(p.value.rewards.items.join(", ")),1)])):g("",!0)])])):g("",!0),p.value?.level_up?(d(),u("div",Pt,[e[22]||(e[22]=t("div",{class:"text-2xl mb-2"},"ðŸŽ‰",-1)),t("div",Vt," Level Up! Agora vocÃª Ã© nÃ­vel "+l(p.value.new_level)+"! ",1)])):g("",!0),t("div",zt,[i(h,{onClick:le},{default:c(()=>[...e[23]||(e[23]=[b(" Batalhar Novamente ",-1)])]),_:1}),i(h,{onClick:e[1]||(e[1]=o=>("navigateTo"in s?s.navigateTo:B(ge))("/home")),variant:"outline"},{default:c(()=>[...e[24]||(e[24]=[b(" Voltar ao Home ",-1)])]),_:1})])]),_:1})]),_:1})])):g("",!0),M.value&&f.value==="selecting"?(d(),u("div",Et,[...e[25]||(e[25]=[t("div",{class:"text-lg text-gray-600 dark:text-gray-400"}," Carregando oponentes... ",-1)])])):g("",!0)])}}});export{Zt as default};
