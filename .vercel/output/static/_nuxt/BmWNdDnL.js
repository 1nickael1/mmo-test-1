import{ao as C,r as l,ap as h,k as y}from"#entry";const x=C("character",()=>{const r=l(null),n=l([]),o=l(!1),s=()=>{const e=y("@mmo/ninja/token");if(!e.value)throw new Error("Usuário não autenticado");return{Authorization:`Bearer ${e.value}`}},u=e=>e==="ninja"?{strength:8,agility:12,defense:6,health:80,max_health:80}:{strength:12,agility:6,defense:10,health:100,max_health:100},i=e=>e<=10?1e3+(e-1)*500:e<=20?Math.floor(5500+Math.pow(e-10,1.8)*1e3):e<=30?Math.floor(15e3+Math.pow(e-20,2.2)*2e3):e<=40?Math.floor(5e4+Math.pow(e-30,2.5)*5e3):Math.floor(15e4+Math.pow(e-40,3)*1e4),f=e=>{const t=i(e.level);return e.xp>=t},g=e=>{const t=e.level+1,a={...e.stats};return a.strength+=1,a.agility+=1,a.defense+=1,a.health+=10,a.max_health+=10,{...e,level:t,stats:a,updated_at:new Date().toISOString()}},v=async(e,t)=>{o.value=!0;try{const{data:a}=await $fetch(`/api/characters/${e}/add-xp`,{method:"POST",headers:s(),body:{xp:t}});if(a){r.value=a;const c=n.value.findIndex(w=>w.id===e);c!==-1&&(n.value[c]=a)}}catch{}finally{o.value=!1}},d=async()=>{o.value=!0;try{const{data:e}=await $fetch("/api/characters",{headers:s()});if(n.value=e||[],r.value){const t=e?.find(a=>a.id===r.value?.id);t&&(r.value=t)}else{const t=localStorage.getItem("@mmo/ninja/selectedCharacterId");if(t&&e){const a=e.find(c=>c.id.toString()===t);a&&(r.value=a)}}}catch(e){console.error("Store: Erro ao carregar personagens:",e)}finally{o.value=!1}},m=e=>{r.value=e,localStorage.setItem("@mmo/ninja/selectedCharacterId",e.id.toString()),window.dispatchEvent(new CustomEvent("characterChanged",{detail:{character:e}}))},p=async()=>{if(!r.value&&(await d(),n.value.length>0)){{const e=localStorage.getItem("@mmo/ninja/selectedCharacterId");if(e){const t=n.value.find(a=>a.id.toString()===e);if(t){r.value=t;return}}}r.value=n.value[0],localStorage.setItem("@mmo/ninja/selectedCharacterId",n.value[0].id.toString())}},S=async e=>{o.value=!0;try{const{data:t}=await $fetch("/api/characters",{method:"POST",headers:s(),body:e});if(t)return n.value.push(t),r.value=t,localStorage.setItem("@mmo/ninja/selectedCharacterId",t.id.toString()),t}catch(t){throw t}finally{o.value=!1}};return{currentCharacter:r,characters:h(n),loading:h(o),getAuthHeaders:s,getBaseStats:u,getXpForLevel:i,canLevelUp:f,levelUp:g,addXp:v,loadCharacters:d,selectCharacter:m,createCharacter:S,ensureCharacterSelected:p}});export{x as u};
